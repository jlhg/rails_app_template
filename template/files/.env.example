# Docker Compose Environment Variables
#
# This file defines all configuration options with their default values.
# The template automatically copies this to .env during project creation.
# Docker Compose loads these variables via the env_file configuration,
# overriding the fallback defaults in AppConfig.
#
# To customize for your environment:
#   1. Edit .env (not this file)
#   2. Adjust values for development/staging/production
#
# All environment variables use the APP_ prefix for consistency.

# ============================================================================
# Database Configuration
# ============================================================================
APP_POSTGRES_HOST=pg
APP_POSTGRES_PORT=5432
APP_POSTGRES_DB=app
APP_POSTGRES_USER=postgres
APP_POSTGRES_PASSWORD_FILE=/run/secrets/pg_password

# Database preparation on startup
# Set to true only when needed: first deploy, migrations, schema changes
APP_RAILS_DB_PREPARE=false

# ============================================================================
# Redis Configuration
# ============================================================================

# Redis Cache (Rails.cache, Rack::Attack, temporary data)
APP_REDIS_CACHE_HOST=redis_cache
APP_REDIS_CACHE_PORT=6379
APP_REDIS_CACHE_PASSWORD_FILE=/run/secrets/redis_cache_password

# Redis Cable (ActionCable WebSocket pub/sub)
APP_REDIS_CABLE_HOST=redis_cable
APP_REDIS_CABLE_PORT=6379
APP_REDIS_CABLE_PASSWORD_FILE=/run/secrets/redis_cable_password

# Redis Session (Access tokens, user sessions, important state)
APP_REDIS_SESSION_HOST=redis_session
APP_REDIS_SESSION_PORT=6379
APP_REDIS_SESSION_PASSWORD_FILE=/run/secrets/redis_session_password

# ============================================================================
# Rails Configuration
# ============================================================================

# Application time zone (Rails TimeZone identifier)
# Affects how times are displayed and stored in logs
# Common values: Taipei, UTC, Tokyo, Hong Kong, Singapore
# See: https://api.rubyonrails.org/classes/ActiveSupport/TimeZone.html
APP_TIME_ZONE=UTC

# Allowed hosts for Rails Host Authorization (comma-separated)
# Protects against DNS rebinding and Host header attacks
# Useful for: Cloudflare Tunnel, ngrok, custom domains
# Example: APP_ALLOWED_HOSTS=example.com,test.example.com,staging.example.com
APP_ALLOWED_HOSTS=

# CORS allowed origins (comma-separated)
# Controls which domains can make cross-origin requests to the API
# Development: "*" (allow all origins, credentials disabled)
# Production: Set to your frontend domain(s) for security (enables credentials support)
# Example: APP_CORS_ALLOWED_ORIGINS=https://app.example.com,https://admin.example.com
# Note: When set to "*", credentials (cookies) are disabled for security
#       When set to specific origins, credentials are automatically enabled
APP_CORS_ALLOWED_ORIGINS=*

# File path containing the application's secret key base for signing
# and encrypting cookies and sessions.
APP_SECRET_KEY_BASE_FILE=/run/secrets/rails_secret_key_base

# ============================================================================
# Application Settings
# ============================================================================

# Email verification code lifetime (in seconds)
# Time limit for email verification code to remain valid
APP_EMAIL_VERIFICATION_CODE_LIFETIME=300

# Registrable lifetime (in seconds)
# Time limit for completing registration after email verification
APP_EMAIL_VERIFICATION_REGISTRABLE_LIFETIME=86400

# Resend cooldown (in seconds)
# Minimum time between resending verification emails
APP_EMAIL_VERIFICATION_RESEND_COOLDOWN=300

# ============================================================================
# Puma Web Server Configuration
# ============================================================================

# Number of worker processes
# Recommended: Set to number of CPU cores for production
# Example: 2 workers × 16 threads = 32 concurrent requests
# Development: 0 (single mode, no workers)
APP_WEB_CONCURRENCY=0

# Number of threads per worker
# Range: 5-32 depending on workload
# Higher values = more concurrent connections (including WebSocket), more memory usage
# Development: 5 threads (lower resource usage)
APP_RAILS_MAX_THREADS=5
APP_RAILS_MIN_THREADS=5

# Worker timeout in seconds
# Increase for long-running requests (file uploads, exports, etc.)
# IMPORTANT: For graceful shutdown, Docker's stop_grace_period (60s) should be > PUMA_WORKER_TIMEOUT
#            to allow all requests to complete before forced termination
APP_PUMA_WORKER_TIMEOUT=30

# ============================================================================
# Mailer Configuration
# ============================================================================

# SMTP server address for sending emails
# Common providers: smtp.mailgun.org, smtp.sendgrid.net, smtp.gmail.com
APP_MAILER_SMTP_ADDRESS=smtp.mailgun.org

# SMTP server port
# Standard ports: 587 (STARTTLS), 465 (SSL/TLS), 25 (plain/deprecated)
APP_MAILER_SMTP_PORT=587

# HELO domain name for SMTP connection
# Should match your email sending domain
APP_MAILER_SMTP_DOMAIN=

# SMTP authentication method
# Options: plain, login, cram_md5
APP_MAILER_SMTP_AUTHENTICATION=plain

# Enable automatic STARTTLS encryption
# Recommended: true for secure email transmission
APP_MAILER_SMTP_ENABLE_STARTTLS_AUTO=true

# SMTP authentication username
# Format varies by provider (email address or API username)
APP_MAILER_SMTP_USER_NAME=

# File path containing SMTP password (Docker secret)
# Secure alternative to storing password in environment variables
APP_MAILER_SMTP_PASSWORD_FILE=/run/secrets/mailer_smtp_password

# Admin email address for receiving notifications
# Used for system notifications like pending user activations
APP_ADMIN_EMAIL=

# Host name for URLs in email content
# Used to generate links in email templates
APP_MAILER_SERVER_HOST=

# Port number for URLs in email content
APP_MAILER_SERVER_PORT=

# Protocol for URLs in email content
APP_MAILER_SERVER_PROTOCOL=https

# ============================================================================
# ActionCable WebSocket Configuration
# ============================================================================

# WebSocket URL for ActionCable
# Example: ws://localhost:3000/api/cable
APP_ACTION_CABLE_URL=

# Allowed origins for WebSocket connections (comma-separated)
# Security: Set to your frontend domain(s) in production
# Example: https://app.example.com,https://admin.example.com
APP_ACTION_CABLE_ALLOWED_ORIGINS=*

# Disable CSRF protection for ActionCable (true for API mode)
# Set to false if you need CSRF protection
APP_ACTION_CABLE_DISABLE_FORGERY_PROTECTION=true

# ============================================================================
# Session Configuration
# ============================================================================

# Session cookie key name
# Used to identify the session cookie in browser
APP_SESSION_KEY=_app_session

# Session expiration time (in days)
# How long a session remains valid before requiring re-authentication
APP_SESSION_EXPIRE_AFTER=90

# Session cookie secure flag (requires HTTPS)
# IMPORTANT: Set to true in production for security
# Set to false only for local HTTP development
APP_SESSION_COOKIE_SECURE=true

# Session cookie SameSite attribute
# Options: strict, lax, none
# - strict: Only send cookies in same-site requests (highest security, may break
#           cross-origin functionality)
# - lax: Send cookies in same-site requests and top-level navigation (balanced security)
# - none: Send cookies in all requests including cross-origin (requires secure=true and HTTPS)
# IMPORTANT: For cross-origin API requests (frontend on different domain), use "none"
APP_SESSION_COOKIE_SAME_SITE=strict

# Session cookie domain (optional, for cross-subdomain sessions)
# Controls which domain can access the session cookie
# Default: Empty (cookie only accessible from current domain)
# Cross-subdomain: Set to parent domain with leading dot (e.g., .example.com)
# Example: Frontend at app.example.com, Backend at api.example.com
#          → APP_SESSION_COOKIE_DOMAIN=.example.com
# Note: Cross-domain (different root domains) requires CORS, not domain setting
APP_SESSION_COOKIE_DOMAIN=

# The lifetime of access tokens, which are short-lived tokens for API
# authentication (in seconds) (default: 1 hour)
APP_SESSION_ACCESS_TOKEN_LIFETIME=3600

# The lifetime of refresh tokens, which are long-lived tokens for
# obtaining new access tokens (in seconds) (default: 30 days)
APP_SESSION_REFRESH_TOKEN_LIFETIME=2592000

# ============================================================================
# Background Jobs Configuration
# ============================================================================

# Number of Solid Queue worker processes
APP_JOB_CONCURRENCY=1

# ============================================================================
# Logging Configuration
# ============================================================================

# Rails log level (debug, info, warn, error, fatal, unknown)
APP_RAILS_LOG_LEVEL=info

# ============================================================================
# Monitoring & Error Tracking
# ============================================================================

# Sentry DSN (Data Source Name)
# Format: https://<key>@<organization>.ingest.sentry.io/<project-id>
# If not set, Sentry will be disabled
APP_SENTRY_DSN=

# Sentry environment name
APP_SENTRY_ENVIRONMENT=production

# Performance monitoring sample rate (optional, default: 0.1 = 10%)
# Range: 0.0 (disabled) to 1.0 (100% of transactions)
# Higher values = more detailed performance data, more quota usage
# Recommended: 0.1 (10%) for production, 0.01 (1%) for high-traffic apps
APP_SENTRY_TRACES_SAMPLE_RATE=0.1
